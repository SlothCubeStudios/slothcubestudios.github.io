<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SlothCube Admin Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #0d0d0d;
      color: #f5f5f5;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* SIDEBAR */
    .sidebar {
      width: 260px;
      background: #111;
      padding: 30px;
      box-sizing: border-box;
      border-right: 1px solid #222;
    }

    .sidebar h2 {
      margin: 0 0 30px;
      font-size: 22px;
      color: #BFA87E;
    }

    .nav a {
      display: block;
      padding: 12px 0;
      color: #ddd;
      text-decoration: none;
      font-size: 15px;
      opacity: 0.8;
    }

    .nav a:hover {
      opacity: 1;
      color: #fff;
    }

    /* MAIN AREA */
    .main {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .header {
      font-size: 30px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .subheader {
      opacity: 0.7;
      margin-bottom: 30px;
    }

    /* INPUTS */
    label {
      display: block;
      margin-top: 20px;
      opacity: 0.8;
    }

    input {
      width: 350px;
      padding: 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: none;
      background: #1e1e1e;
      color: #fff;
      font-size: 15px;
    }

    button {
      margin-top: 25px;
      padding: 12px 24px;
      background: #BFA87E;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      color: #000;
      font-size: 15px;
    }

    button:hover {
      opacity: 0.9;
    }

    #status {
      margin-top: 20px;
      opacity: 0.7;
      font-size: 14px;
    }

    .card {
      background: #151515;
      padding: 25px;
      border-radius: 12px;
      border: 1px solid #222;
      max-width: 600px;
    }
  </style>
</head>

<body>

  <div class="sidebar">
    <h2>SlothCube Admin</h2>

    <div class="nav">
      <a href="#">Dashboard</a>
      <a href="#">Manage Games</a>
      <a href="#">Users</a>
      <a href="#">Settings</a>
    </div>
  </div>

  <div class="main">
    <div class="header">Game Editor</div>
    <div class="subheader">Manage game data stored in Supabase</div>

    <div class="card">

      <label>Game ID</label>
      <input id="gameId" placeholder="whispers" />

      <label>Game Title</label>
      <input id="title" placeholder="Whispers in the Dark" />

      <label>Price (Â£)</label>
      <input id="price" type="number" step="0.01" placeholder="9.99" />

      <button onclick="loadGame()">Load Game</button>
      <button onclick="saveGame()">Save Game</button>

      <div id="status">Waiting...</div>
    </div>
  </div>

  <!-- FIXED JS (Wrapped in DOMContentLoaded so Supabase loads correctly) -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      console.log("Page loaded. Initialising Supabase...");

      const supabase = window.supabase.createClient(
        "https://ufymmulksqsxpzfqbmys.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVmeW1tdWxrc3FzeHB6ZnFibXlzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzNzYwMDksImV4cCI6MjA3OTk1MjAwOX0.De22E039H6XhYy2PwmmgrSrSHAVuUmkuFiIM0I_RA-A"
      );

      console.log("Supabase initialised.");

      // === LOAD GAME ===
      window.loadGame = async function () {
        const id = document.getElementById("gameId").value;
        document.getElementById("status").innerText = "Loading...";

        const { data, error } = await supabase
          .from("games")
          .select("*")
          .eq("id", id)
          .single();

        if (error || !data) {
          document.getElementById("status").innerText = "Game not found.";
          return;
        }

        document.getElementById("title").value = data.title;
        document.getElementById("price").value = data.price;

        document.getElementById("status").innerText = "Loaded!";
      };

      // === SAVE GAME ===
      window.saveGame = async function () {
        const id = document.getElementById("gameId").value;
        const title = document.getElementById("title").value;
        const price = parseFloat(document.getElementById("price").value);

        document.getElementById("status").innerText = "Saving...";

        const { error } = await supabase
          .from("games")
          .upsert({ id, title, price });

        if (error) {
          document.getElementById("status").innerText = "Error saving game!";
          return;
        }

        document.getElementById("status").innerText = "Saved!";
      };
    });
  </script>

</body>
</html>
